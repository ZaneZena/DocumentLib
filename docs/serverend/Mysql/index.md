
# ðŸŒˆMysqlåŸºç¡€

[Mysqlå¸¸ç”¨æŸ¥è¯¢è¯­å¥å‘€](./mysql.md)


# ä¸€ã€mySQLé”

>åœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘ä¸­å¯èƒ½å¾ˆå°‘è€ƒè™‘é”çš„é—®é¢˜(ç‰¹åˆ«æ˜¯åšå‰ç«¯çš„æ—¶å€™),è¿™æ˜¯å› ä¸ºæ•°æ®åº“éšå¼å¸®æˆ‘ä»¬æ·»åŠ äº†é”:
>
>* å¯¹äºŽ`UPDATEã€DELETEã€INSERT`è¯­å¥,InnoDB(*mySQLçš„æ•°æ®åº“å¼•æ“Žä¹‹ä¸€,çŽ°ä¸ºMySQLçš„é»˜è®¤å­˜å‚¨å¼•æ“Ž*)ä¼šè‡ªåŠ¨å°†æ¶‰åŠçš„æ•°æ®é›†æ·»åŠ  **æŽ’ä»–é”(Xé”)**
>* äº‹åŠ¡æ‹¿åˆ°æŸä¸€è¡Œè®°å½•çš„ **å…±äº«é”(Sé”)** æ‰å¯ä»¥è¯»å–è¿™ä¸€è¡Œ,å¹¶é˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹å…¶æ·»åŠ æŽ’ä»–é”
>* äº‹åŠ¡æ‹¿åˆ°ä¸€è¡Œè®°å½•çš„ **æŽ’ä»–é”(Xé”)** æ‰å¯ä»¥ä¿®æ”¹æˆ–å’Œåˆ é™¤è¿™ä¸€è¡Œ
>
>##### å…±äº«é”çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜è¯»å–çš„å¹¶å‘;æŽ’ä»–é”çš„ç›®çš„æ—¶ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§
>
>æˆ‘ä»¬åœ¨æŸäº›ç‰¹å®šçš„åœºæ™¯ä¸‹æ‰éœ€è¦æ‰‹åŠ¨è¿›è¡ŒåŠ æ‰€,å­¦ä¹ æ•°æ®åº“é”çŸ¥è¯†å°±æ˜¯ä¸ºäº†:
>
>* æ›´å¥½åœ°æŽ§åˆ¶ç¨‹åºä»£ç 
>* èƒ½è®©æˆ‘ä»¬åœ¨ç‰¹å®šåœºæ™¯ä¸Šæ´¾ä¸Šç”¨åœº
>* æž„å»ºè‡ªå·±çš„æ•°æ®åº“çŸ¥è¯†ä½“ç³»
>
>![image-20220319143229397](Mysqlå­¦ä¹ ç¬”è®°ä¸­çš„å›¾ç‰‡/image-20220319143229397.png) 

## 1ã€æ‚²è§‚é”

>æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡åŽ»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚
>
>* æ‚²è§‚é”ï¼šå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå±è”½ä¸€åˆ‡å¯èƒ½è¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œã€‚
>* Java synchronized å°±å±žäºŽæ‚²è§‚é”çš„ä¸€ç§å®žçŽ°ï¼Œæ¯æ¬¡çº¿ç¨‹è¦ä¿®æ”¹æ•°æ®æ—¶éƒ½å…ˆèŽ·å¾—é”ï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ“ä½œæ•°æ®ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ä¼šè¢«blockã€‚
>* `å…±äº«é”`ä¸Ž`æŽ’ä»–é”`éƒ½æ˜¯**æ‚²è§‚é”**çš„èŒƒç•´

### â… - æ³¨æ„ç‚¹

>è¦ä½¿ç”¨æ‚²è§‚é”æˆ‘ä»¬å°±å¿…é¡»å…ˆå…³é—­Mysqlæ•°æ®åº“çš„è‡ªåŠ¨æäº¤å±žæ€§,å› ä¸ºMysqlé»˜è®¤ä½¿ç”¨ autocommit æ¨¡å¼
>
>ä¹Ÿå°±æ˜¯è¯´å½“ä½ æ‰§è¡Œä¸€ä¸ªæ›´æ–°æ“ä½œ,Mysqlä¼šç«‹å³å°†ç»“æžœè¿›è¡Œæäº¤
>
>###### æŽ’ä»–é”ä¸Žå…±äº«é”æ˜¯æ‚²è§‚é”çš„ä¸åŒå®žçŽ°,ä»–ä»¬éƒ½å±žäºŽæ‚²è§‚é”çš„èŒƒç•´
>
>```java
>/**
>    * æ›´æ–°åº“å­˜(ä½¿ç”¨æ‚²è§‚é”)
>    * @param productId
>    * @return
>*/
>    public boolean updateStock(Long productId){
>        //å…ˆé”å®šå•†å“åº“å­˜è®°å½•
>        ProductStock product = query("SELECT * FROM tb_product_stock WHERE product_id=#{productId} FOR UPDATE", productId);
>        if (product.getNumber() > 0) {
>            int updateCnt = update("UPDATE tb_product_stock SET number=number-1 WHERE product_id=#{productId}", productId);
>            if(updateCnt > 0){    //æ›´æ–°åº“å­˜æˆåŠŸ
>                return true;
>            }
>        }
>        return false;
>    }
>```

### â…¡- æŽ’ä»–é”

>æŽ’ä»–é”ä¸Žå…±äº«é”ç›¸å¯¹åº”,å°±æ˜¯æŒ‡å¯¹äºŽå¤šä¸ªä¸åŒäº‹åŠ¡,å¯¹åŒä¸€ä¸ªèµ„æºåªèƒ½æœ‰ä¸€æŠŠé”,ä¸Žå…±äº«é”ç±»ä¼¼,åœ¨éœ€è¦æ‰§è¡Œçš„è¯­å¥åŽé¢åŠ ä¸Š `for update` å°±å¯ä»¥äº†
>
>* ç”¨åŸŸæ•°æ®ä¿®æ”¹æ“ä½œ,ä¾‹å¦‚:`UPDATEã€DELETEã€INSERT`è¯­å¥.ç¡®ä¿ä¸ä¼šåŒæ—¶å¯¹åŒä¸€èµ„æºè¿›è¡Œå¤šé‡æ›´æ–°
>* å¦‚æžœäº‹åŠ¡Tå¯¹æ•°æ®AåŠ ä¸ŠæŽ’ä»–é”åŽ,åˆ™å…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹AåŠ ä»»ä½•ç±»åž‹çš„å°é”.
>* èŽ·å‡†æŽ’ä»–é”çš„æ•°æ®æŠ€èƒ½è¯»å–æ•°æ®è¿˜èƒ½ä¿®æ”¹æ•°æ®

### â…¢ - å…±äº«é”

>**å…±äº«é”(Sé”)** ç”¨äºŽä¸æ›´æ”¹æˆ–ä¸æ›´æ–°æ•°æ®çš„æ“ä½œ(åªè¯»æ“ä½œ),ä¾‹å¦‚`SELECT`è¯­å¥
>
>å¦‚æžœäº‹åŠ¡Tå¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”åŽ: **å…¶ä»–äº‹åŠ¡åªèƒ½å¯¹Aå†åŠ å…±äº«é”,ä¸èƒ½åŠ æŽ’ä»–é”.èŽ·å‡†å…±äº«é”çš„äº‹åŠ¡åªèƒ½è¯»æ•°æ®,ä¸å¯ä¿®æ”¹æ•°æ®**

#### ä¸¾ä¸ªæ —å­

>1. å¼€å¯å…±äº«é”
>
>   ```sql
>   begin;
>   SELECT * from city where id = "1" lock in share mode;
>   ```
>
>2. ç„¶åŽåœ¨å¦ä¸€ä¸ªæŸ¥è¯¢çª—å£ä¸­å¯¹idä¸º1çš„æ•°æ®è¿›è¡Œæ›´æ–°
>
>   ```sql
>   update  city set name="åŠªåŠ›å­¦ä¹ çš„æ±ª" where id ="1";
>   ```
>
>3. æ­¤æ—¶æ“ä½œç•Œé¢è¿›å…¥äº†å¡é¡¿çŠ¶æ€,è¿‡äº†å‡ ç§’ä¹Ÿæç¤ºé”™è¯¯ä¿¡æ¯
>
>   ```sql
>   [SQL]update  city set name="åŠªåŠ›å­¦ä¹ çš„æ±ª" where id ="1";
>   [Err] 1205 - Lock wait timeout exceeded; try restarting transaction
>   ```
>
>4. å¦‚æ­¤å°±è¯æ˜Žå¯¹äºŽ `id=1` çš„è®°å½•æž·é”æˆåŠŸäº†:
>
>   > åœ¨ä¸Šä¸€æ¡è®°å½•è¿˜æ²¡æœ‰commmitä¹‹å‰,è¿™æ¡ `id=1`çš„è®°å½•è¢«é”ä½äº†,åªæœ‰åœ¨ä¸Šä¸€ä¸ªäº‹åŠ¡ä¹¦æˆ¿æŽ‰é”åŽæ‰èƒ½è¿›è¡Œæ“ä½œ,æˆ–ç”¨å…±äº«é”æ‰èƒ½å¯¹æ­¤æ•°æ®è¿›è¡Œæ“ä½œ

## 2ã€ä¹è§‚é”

>ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡åŽ»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æäº¤æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰åŽ»æ›´æ–°è¿™ä¸ªæ•°æ®ã€‚ä¹è§‚é”é€‚ç”¨äºŽè¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ï¼Œè¿™æ ·å¯ä»¥æé«˜åžåé‡ã€‚
>
>ä¹è§‚é”ï¼šå‡è®¾ä¸ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œåªåœ¨æäº¤æ“ä½œæ—¶æ£€æŸ¥æ˜¯å¦è¿åæ•°æ®å®Œæ•´æ€§ã€‚

### â…  - ä¹è§‚é”çš„ä¸¤ç§æ–¹å¼

#### â‘  ä½¿ç”¨æ•°æ®ç‰ˆæœ¬å®žçŽ°

>###### ä½¿ç”¨æ•°æ®ç‰ˆæœ¬ï¼ˆVersionï¼‰è®°å½•æœºåˆ¶å®žçŽ°ï¼Œè¿™æ˜¯ä¹è§‚é”æœ€å¸¸ç”¨çš„ä¸€ç§å®žçŽ°æ–¹å¼ã€‚ä½•è°“æ•°æ®ç‰ˆæœ¬ï¼Ÿ
>
>1. å³ä¸ºæ•°æ®å¢žåŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“è¡¨å¢žåŠ ä¸€ä¸ªæ•°å­—ç±»åž‹çš„ â€œversionâ€ å­—æ®µæ¥å®žçŽ°ã€‚
>2. å½“è¯»å–æ•°æ®æ—¶ï¼Œå°†versionå­—æ®µçš„å€¼ä¸€åŒè¯»å‡ºï¼Œæ•°æ®æ¯æ›´æ–°ä¸€æ¬¡ï¼Œå¯¹æ­¤versionå€¼åŠ ä¸€ã€‚
>3. å½“æˆ‘ä»¬æäº¤æ›´æ–°çš„æ—¶å€™ï¼Œåˆ¤æ–­æ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯ä¸Žç¬¬ä¸€æ¬¡å–å‡ºæ¥çš„versionå€¼è¿›è¡Œæ¯”å¯¹
>4. å¦‚æžœæ•°æ®åº“è¡¨å½“å‰ç‰ˆæœ¬å·ä¸Žç¬¬ä¸€æ¬¡å–å‡ºæ¥çš„versionå€¼ç›¸ç­‰ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ã€‚

#### â‘¡ ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆtimestampï¼‰

>ä¹è§‚é”å®šçš„ç¬¬äºŒç§å®žçŽ°æ–¹å¼å’Œç¬¬ä¸€ç§å·®ä¸å¤š:
>
>1. åŒæ ·æ˜¯åœ¨éœ€è¦ä¹è§‚é”æŽ§åˆ¶çš„tableä¸­å¢žåŠ ä¸€ä¸ªå­—æ®µï¼Œåç§°æ— æ‰€è°“ï¼Œå­—æ®µç±»åž‹ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆtimestampï¼‰
>2. å’Œä¸Šé¢çš„versionç±»ä¼¼ï¼Œä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶å€™æ£€æŸ¥å½“å‰æ•°æ®åº“ä¸­æ•°æ®çš„æ—¶é—´æˆ³å’Œè‡ªå·±æ›´æ–°å‰å–åˆ°çš„æ—¶é—´æˆ³è¿›è¡Œå¯¹æ¯”
>3. å¦‚æžœä¸€è‡´åˆ™OKï¼Œå¦åˆ™å°±æ˜¯ç‰ˆæœ¬å†²çªã€‚

### â…¡- ä¸¾ä¸ªæ —å­

>```java
>/**
>     * ä¸‹å•å‡åº“å­˜
>     * @param productId
>     * @return
>*/
>    public boolean updateStock(Long productId){
>        int updateCnt = 0;
>        while (updateCnt == 0) {
>            ProductStock product = query("SELECT * FROM tb_product_stock WHERE product_id=#{productId}", productId);
>            if (product.getNumber() > 0) {
>                //è¿™é‡Œè¿›è¡Œåˆ¤æ–­,numberéœ€è¦ç­‰äºŽnumberæ‰èƒ½æ›´æ–°
>                updateCnt = update("UPDATE tb_product_stock SET number=number-1 WHERE product_id=#{productId} AND number=#{number}", productId, product.getNumber());
>                if(updateCnt > 0){    //æ›´æ–°åº“å­˜æˆåŠŸ
>                    return true;
>                }
>            } else {    //å–å®Œå•¦
>                return false;
>            }
>        }
>        return false;
>    }
>```

## 3ã€è¡Œé”

>è¡Œé”ï¼Œç”±å­—é¢æ„æ€ç†è§£ï¼Œå°±æ˜¯ç»™æŸä¸€è¡ŒåŠ ä¸Šé”ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¡è®°å½•åŠ ä¸Šé”ã€‚
>
>æ¯”å¦‚ä¹‹å‰çš„å…±äº«é”è¯­å¥
>
>```sql
>select * from city where id = "1" lock in share mode; 
>```
>
>ç”±äºŽå¯¹äºŽcityè¡¨ä¸­,idå­—æ®µä¸ºä¸»é”®ï¼Œå°±ä¹Ÿç›¸å½“äºŽç´¢å¼•ã€‚æ‰§è¡ŒåŠ é”æ—¶ï¼Œä¼šå°†idè¿™ä¸ªç´¢å¼•ä¸º1çš„è®°å½•åŠ ä¸Šé”ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å°±æ˜¯è¡Œé”ã€‚
>
>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰è¡¨é”,ä½†ä¸è¿›è¡Œæ·±å…¥ç ”ç©¶è®°å½•

### â…  - InnoDBå¼•æ“Žçš„æ•°æ®åº“çŠ¶æ€æŸ¥çœ‹ï¼ˆåˆ†æžè¡Œé”ï¼‰

>é€šè¿‡æ£€æŸ¥InnoDB_row_lockçŠ¶æ€å˜é‡æ¥åˆ†æžç³»ç»Ÿä¸Šçš„è¡Œé”çš„äº‰å¤ºæƒ…å†µ
>
>```sql
>show status like 'innodb_row_lock%';
>```
>
>å¯¹äºŽå„ä¸ªçŠ¶æ€è¯´æ˜Žå¦‚ä¸‹ï¼š
>
>- `Innodb_row_lock_current_waits`: å½“å‰æ­£åœ¨ç­‰å¾…é”çš„æ•°é‡ï¼›
>- `Innodb_row_lock_time`: ä»Žç³»ç»Ÿå¯åŠ¨åˆ°çŽ°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦ï¼›
>- `Innodb_row_lock_time_avg`ï¼šæ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é—´ï¼›
>- `Innodb_row_lock_time_max`: ä»Žç³»ç»Ÿå¯åŠ¨åˆ°çŽ°åœ¨ç­‰å¾…æœ€é•¿çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´é•¿åº¦ï¼›
>- `Innodb_row_lock_waits`: ç³»ç»Ÿå¯åŠ¨åˆ°çŽ°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•°



# äºŒã€æ•°æ®åº“è®¾è®¡

## 1ã€æ•°æ®åº“è®¾è®¡ä¸‰å¤§èŒƒå¼

>ä¸ºäº†å»ºç«‹å†—ä½™è¾ƒå°ã€ç»“æž„åˆç†çš„æ•°æ®åº“ï¼Œè®¾è®¡æ•°æ®åº“æ—¶å¿…é¡»éµå¾ªä¸€å®šçš„è§„åˆ™ã€‚åœ¨å…³ç³»åž‹æ•°æ®åº“ä¸­è¿™ç§è§„åˆ™å°±ç§°ä¸ºèŒƒå¼ã€‚èŒƒå¼æ˜¯ç¬¦åˆæŸä¸€ç§è®¾è®¡è¦æ±‚çš„æ€»ç»“ã€‚è¦æƒ³è®¾è®¡ä¸€ä¸ªç»“æž„åˆç†çš„å…³ç³»åž‹æ•°æ®åº“ï¼Œå¿…é¡»æ»¡è¶³ä¸€å®šçš„èŒƒå¼ã€‚
>
>1. æ¯ä¸€åˆ—åªæœ‰ä¸€ä¸ªå€¼
>2. æ¯ä¸€è¡Œéƒ½èƒ½åŒºåˆ†ã€‚
>3. æ¯ä¸€ä¸ªè¡¨éƒ½ä¸åŒ…å«å…¶ä»–è¡¨å·²ç»åŒ…å«çš„éžä¸»å…³é”®å­—ä¿¡æ¯ã€‚





# ä¸‰ã€Mysqlç›¸å…³çš„é—®é¢˜ä¸Žè§£ç­”

## 1ã€MyISAMç´¢å¼•åº•å±‚æ˜¯ä»€ä¹ˆç»“æž„? --`B+ Tree`

>###### `B+ Tree`
>
>**MyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€**ã€‚è€Œåœ¨InnoDBä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰`B+Tree`ç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æž„ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•
>
>![image-20220319152214886](Mysqlå­¦ä¹ ç¬”è®°ä¸­çš„å›¾ç‰‡/image-20220319152214886.png) 



## 2ã€MySQLå¦‚ä½•è§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»

### â…  - è„è¯»

>###### ä»€ä¹ˆæ˜¯è„è¯»? 
>
>è„è¯»æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸­è®¿é—®åˆ°äº†å¦å¤–ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®
>
>![image-20220319152828490](Mysqlå­¦ä¹ ç¬”è®°ä¸­çš„å›¾ç‰‡/image-20220319152828490.png)
>
>* å¦‚æžœä¼šè¯2æ›´æ–°ageåˆ°10,ä½†æ˜¯åœ¨commitä¹‹å‰ä¼šè¯1å¸Œæœ›å¾—åˆ°age: é‚£ä¹ˆä¼šèŽ·å¾—çš„å€¼å°±æ˜¯æ›´æ–°å‰çš„å€¼
>* æˆ–è€…ä¼šè¯2æ›´æ–°äº†å€¼ä½†æ˜¯æ‰§è¡Œäº† `rollback`,è€Œä¼šè¯1æ‹¿åˆ°çš„ä»æ˜¯10,è¿™å°±æ˜¯è„è¯»

### â…¡ - å¹»è¯»

>ä¸€ä¸ªäº‹åŠ¡è¯»å–2æ¬¡,å¾—åˆ°çš„è®°å½•æ¡æ•°ä¸ä¸€è‡´
>
>![image-20220319153140622](Mysqlå­¦ä¹ ç¬”è®°ä¸­çš„å›¾ç‰‡/image-20220319153140622.png) 
>
>ä¸Šå›¾å¾ˆæ˜Žæ˜¾çš„è¡¨ç¤ºäº†è¿™ä¸ªæƒ…å†µï¼Œç”±äºŽåœ¨ä¼šè¯ 1 ä¹‹é—´æ’å…¥äº†ä¸€ä¸ªæ–°çš„å€¼ï¼Œæ‰€ä»¥å¾—åˆ°çš„ä¸¤æ¬¡æ•°æ®å°±ä¸ä¸€æ ·äº†

### â…¢ - ä¸å¯é‡å¤è¯»

>ä¸€ä¸ªäº‹åŠ¡è¯»å–åŒä¸€æ¡è®°å½•2æ¬¡,å¾—åˆ°çš„ç»“æžœä¸ä¸€è‡´
>
>![image-20220319153324397](Mysqlå­¦ä¹ ç¬”è®°ä¸­çš„å›¾ç‰‡/image-20220319153324397.png) 
>
>ç”±äºŽåœ¨è¯»å–ä¸­é—´å˜æ›´äº†æ•°æ®ï¼Œæ‰€ä»¥ä¼šè¯ 1 äº‹åŠ¡æŸ¥è¯¢æœŸé—´çš„å¾—åˆ°çš„ç»“æžœå°±ä¸ä¸€æ ·äº†

### â…£ - è§£å†³æ–¹æ¡ˆ

> è§£å†³æ–¹æ¡ˆå³æ˜¯ä¸‹é¢å››ç§éš”ç¦»çº§åˆ«,ä»–ä»¬å¯ä»¥æœ€å¤§ç¨‹åº¦é¿å…ä»¥ä¸Šä¸‰ç§æƒ…å†µçš„å‘ç”Ÿ



## 3ã€MySQL æ•°æ®éš”ç¦»çº§åˆ«

> MySQL é‡Œæœ‰å››ä¸ªéš”ç¦»çº§åˆ«ï¼š
>
>1. Read uncommttied(å¯ä»¥è¯»å–æœªæäº¤æ•°æ®)--æœªæŽˆæƒè¯»å–
>2. Read committed(å¯ä»¥è¯»å–å·²æäº¤æ•°æ®) --æŽˆæƒè¯»å–
>3. Repeatable read(å¯é‡å¤è¯») --å¯é‡å¤è¯»å–
>4. Serializable(å¯ä¸²è¡ŒåŒ–) --åºåˆ—åŒ–
>
>###### åœ¨ InnoDB ä¸­ï¼Œé»˜è®¤ä¸º Repeatable çº§åˆ«ï¼ŒInnoDB ä¸­ä½¿ç”¨ä¸€ç§è¢«ç§°ä¸º next-key locking çš„ç­–ç•¥æ¥é¿å…å¹»è¯»(phantom)çŽ°è±¡çš„äº§ç”Ÿ
>
>ä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¼šå¯¼è‡´ä¸åŒçš„é—®é¢˜ï¼š
>
>![image-20220319153533049](Mysqlå­¦ä¹ ç¬”è®°ä¸­çš„å›¾ç‰‡/image-20220319153533049.png) 

### â…  - Read uncommttied--æœªæŽˆæƒè¯»å–

>ä¹Ÿç§°ä¸ºè¯»æœªæäº¤(Read Uncommitted)ï¼šå…è®¸è„è¯»å–ï¼Œä½†ä¸å…è®¸æ›´æ–°ä¸¢å¤±ã€‚
>
>å¦‚æžœä¸€ä¸ªäº‹åŠ¡å·²ç»å¼€å§‹å†™æ•°æ®ï¼Œåˆ™å¦å¤–ä¸€ä¸ªäº‹åŠ¡åˆ™ä¸å…è®¸åŒæ—¶è¿›è¡Œå†™æ“ä½œï¼Œä½†å…è®¸å…¶ä»–äº‹åŠ¡è¯»æ­¤è¡Œæ•°æ®ã€‚è¯¥éš”ç¦»çº§åˆ«å¯ä»¥é€šè¿‡â€œæŽ’ä»–å†™é”â€å®žçŽ°

### â…¡ - Read committed--æŽˆæƒè¯»å–

>ä¹Ÿç§°ä¸ºè¯»æäº¤(Read Committed)ï¼šå…è®¸ä¸å¯é‡å¤è¯»å–ï¼Œä½†ä¸å…è®¸è„è¯»å–ã€‚
>
>è¿™å¯ä»¥é€šè¿‡â€œçž¬é—´å…±äº«è¯»é”â€å’Œâ€œæŽ’ä»–å†™é”â€å®žçŽ°ã€‚è¯»å–æ•°æ®çš„äº‹åŠ¡å…è®¸å…¶ä»–äº‹åŠ¡ç»§ç»­è®¿é—®è¯¥è¡Œæ•°æ®ï¼Œä½†æ˜¯æœªæäº¤çš„å†™äº‹åŠ¡å°†ä¼šç¦æ­¢å…¶ä»–äº‹åŠ¡è®¿é—®è¯¥è¡Œã€‚

### â…¢ - Repeatable read--å¯é‡å¤è¯»å–

>å¯é‡å¤è¯»å–(Repeatable Read)ï¼šç¦æ­¢ä¸å¯é‡å¤è¯»å–å’Œè„è¯»å–ï¼Œä½†æ˜¯æœ‰æ—¶å¯èƒ½å‡ºçŽ°å¹»è¯»æ•°æ®ã€‚
>
>è¿™å¯ä»¥é€šè¿‡â€œå…±äº«è¯»é”â€å’Œâ€œæŽ’ä»–å†™é”â€å®žçŽ°ã€‚è¯»å–æ•°æ®çš„äº‹åŠ¡å°†ä¼šç¦æ­¢å†™äº‹åŠ¡(ä½†å…è®¸è¯»äº‹åŠ¡)ï¼Œå†™äº‹åŠ¡åˆ™ç¦æ­¢ä»»ä½•å…¶ä»–äº‹åŠ¡ã€‚

### â…£ - Serializable--åºåˆ—åŒ–

>åºåˆ—åŒ–(Serializable)ï¼šæä¾›ä¸¥æ ¼çš„äº‹åŠ¡éš”ç¦»ã€‚å®ƒè¦æ±‚äº‹åŠ¡åºåˆ—åŒ–æ‰§è¡Œï¼Œäº‹åŠ¡åªèƒ½ä¸€ä¸ªæŽ¥ç€ä¸€ä¸ªåœ°æ‰§è¡Œï¼Œä¸èƒ½å¹¶å‘æ‰§è¡Œã€‚
>
>* ä»…ä»…é€šè¿‡â€œè¡Œçº§é”â€æ˜¯æ— æ³•å®žçŽ°äº‹åŠ¡åºåˆ—åŒ–çš„ï¼Œå¿…é¡»é€šè¿‡å…¶ä»–æœºåˆ¶ä¿è¯æ–°æ’å…¥çš„æ•°æ®ä¸ä¼šè¢«åˆšæ‰§è¡ŒæŸ¥è¯¢æ“ä½œçš„äº‹åŠ¡è®¿é—®åˆ°ã€‚
>* éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œè¶Šèƒ½ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œä½†æ˜¯å¯¹å¹¶å‘æ€§èƒ½çš„å½±å“ä¹Ÿè¶Šå¤§ã€‚
>* å¯¹äºŽå¤šæ•°åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘æŠŠæ•°æ®åº“ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«è®¾ä¸º`Read Committed(æŽˆæƒè¯»å–)`ã€‚å®ƒèƒ½å¤Ÿé¿å…è„è¯»å–ï¼Œè€Œä¸”å…·æœ‰è¾ƒå¥½çš„å¹¶å‘æ€§èƒ½ã€‚å°½ç®¡å®ƒä¼šå¯¼è‡´ä¸å¯é‡å¤è¯»ã€å¹»è¯»å’Œç¬¬äºŒç±»ä¸¢å¤±æ›´æ–°è¿™äº›å¹¶å‘é—®é¢˜ï¼Œåœ¨å¯èƒ½å‡ºçŽ°è¿™ç±»é—®é¢˜çš„ä¸ªåˆ«åœºåˆï¼Œå¯ä»¥ç”±åº”ç”¨ç¨‹åºé‡‡ç”¨æ‚²è§‚é”æˆ–ä¹è§‚é”æ¥æŽ§åˆ¶ã€‚



# å››ã€å¸¸è§çš„æŠ¥é”™ä¸Žè§£å†³

## 1ã€è§£é™¤è¾“å…¥çš„å®‰å…¨æ¨¡å¼

>1. æŠ¥é”™:`You are using safe update mode and you tried to update a table without a WHERE that uses a KEY column.  To disable safe mode, toggle the option in Preferences -> SQL Editor and reconnect.	0.000 sec`
>
>2. è¿™æ˜¯å› ä¸ºMySqlè¿è¡Œåœ¨safe-updatesæ¨¡å¼ä¸‹ï¼Œè¯¥æ¨¡å¼ä¼šå¯¼è‡´éžä¸»é”®æ¡ä»¶ä¸‹`æ— æ³•æ‰§è¡Œupdateæˆ–è€…deleteå‘½ä»¤`ã€‚
>
> 3. show variables like â€˜SQL_SAFE_UPDATESâ€™;æŸ¥çœ‹å¼€å…³çŠ¶æ€ã€‚
>
> 4. æ‰§è¡Œå‘½ä»¤SET SQL_SAFE_UPDATES = 0;ä¿®æ”¹ä¸‹æ•°æ®åº“æ¨¡å¼
>
>    ![image-20210512185116624](Mysqlå­¦ä¹ ç¬”è®°ä¸­çš„å›¾ç‰‡/image-20210512185116624.png)
>
>5. è‡³æ­¤å¯ä»¥æ­£å¸¸ä¿®æ”¹äº†



## 2ã€å¿˜è®°å¯†ç  ä¿®æ”¹å¯†ç 

>1. æŠ¥é”™:`ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)`,åŽé¢è¿™ä¸ªä¹Ÿå¯èƒ½æ˜¯`password:NO`
>
>2. å‡ºçŽ°åœºæ™¯,è¿™ä¸ªé—®é¢˜æ€»æ˜¯åœ¨`Mysql8.0`ç‰ˆæœ¬å‡ºçŽ°,æˆ‘ä»¬ç­å¾ˆå¤šåŒå­¦éƒ½å‡ºçŽ°äº†è¿™ä¸ªé—®é¢˜,åŒ…æ‹¬å‘½åå¯†ç æ­£ç¡®,ä½†æ˜¯å°±æ˜¯æ— æ³•è¯»å–é“¾æŽ¥æ•°æ®åº“,è¿™æ—¶å°±éœ€è¦ä¿®æ”¹å¯†ç 
>
>3. æ­¤å¤„ç»™å‡ºä¸€ä¸ªä¸ªäººè§‰å¾—æœ€ç®€å•çš„æ–¹æ³•:
>
>  4. æ‰“å¼€`æœåŠ¡`,æ‰¾åˆ°``Mysql`æœåŠ¡,åŒå‡»æ‰“å¼€
>  5. å¦‚æžœ`MysqlId`åœ¨è¿è¡Œ,éœ€è¦å…ˆå…³é—­
>  6. ç›´æŽ¥åœ¨`ç™»å½•`ä¸­ä¿®æ”¹å¯†ç 
>  7. é‡å¯æœåŠ¡
>
>  ![image-20210524173910554](Mysqlå­¦ä¹ ç¬”è®°ä¸­çš„å›¾ç‰‡/image-20210524173910554.png)
>
>

